Capital Market Line: $\mu=R+\frac{\mu_{M}-R}{\sigma_{M}}\sigma$ for any efficient portfolio $(\sigma,\mu)$. 
[[CAPM]] Formula: $\mu_{i}=R+\beta_{i}(\mu_{M}-R)$ where $\beta_{i}=\frac{Cov(M,i)}{\sigma_{m}^2}$.
Proof: $\pi_{i}^M$ is the proportion of asset $i$ in the market portfolio. Then we know that: $\mu_{M}=\sum_{i=1}^N \pi_{i}^M \mu_{i}$,  $\sigma^2_{M}=\sum^N_{i=1}\sum^N_{j=1}\pi^M_{i}\pi^M_{j}\sigma_{ij}$,   $\sum^N_{i=1}\pi^M_{i}=1$.

Being on the efficient frontier, portoflio $M$ has the largest possible slope of all the lines that contain the risk-free asset and any portfolio of risky assets. Thus, the market portfolios proportions have to solve the maximization problem: $$\frac{\mu_{M}-R}{\sigma_{M}}=max_{\pi_{i}}\frac{\left( \sum^N_{i=1}\pi_{i}(\mu_{i-R}) \right)}{\left( \sum^N_{i=1}\sum^N_{j=1}\pi_{i}\pi_{j}\sigma_{ij} \right)^{1/2}}$$
with fact that $\sum^N_{i=1}\pi_{i}R=R$. Take the derivative of the expression we are trying to maiximze with respect to $\pi_{i}$ at the point $\pi_i=\pi_{i}^M$ we get: